<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MARA BANGSAT 1312 ACAB</title>
  <style>
    body {
      font-family: monospace;
      background: #0a0a0a;
      color: #f0f0f0;
      display: grid;
      place-items: center;
      height: 100vh;
      margin: 0;
    }
    .app {
      width: min(960px, 100%);
      background: #111;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.9);
    }
    h1 {
      font-size: 22px;
      margin: 0 0 12px;
      text-align: center;
      letter-spacing: 2px;
    }
    .dropzone {
      border: 3px dashed #888;
      border-radius: 6px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 16px;
      background: #1b1b1b;
    }
    .dropzone.dragover { border-color: #ff3b8d; background: #222; }
    canvas { max-width: 100%; height: auto; display: block; margin: 0 auto; background:#000; }
    button {
      background: #ff3b8d;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="app">
    <h1>MARA BANGSAT 1312 ACAB</h1>
    <div id="drop" class="dropzone">Drop image here or click to select</div>
    <input id="file" type="file" accept="image/*" hidden />
    <canvas id="canvas"></canvas>
    <button id="download" disabled>Download PNG</button>
  </div>

  <script>
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('file');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const downloadBtn = document.getElementById('download');

    function hexToRgb(hex){
      const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return m ? {r:parseInt(m[1],16), g:parseInt(m[2],16), b:parseInt(m[3],16)} : {r:0,g:0,b:0};
    }

    // Define strong tritone palette
    const col1 = hexToRgb("#0D3B66"); // Resistance Blue
    const col2 = hexToRgb("#FF6B8A"); // Brave Pink
    const col3 = hexToRgb("#1B998B"); // Hero Green

    function toLuminance(r,g,b){
      return 0.2126*r + 0.7152*g + 0.0722*b;
    }

    function processExtreme(image){
      canvas.width = image.naturalWidth;
      canvas.height = image.naturalHeight;
      ctx.drawImage(image,0,0);
      const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
      const d = imgData.data;

      for(let i=0;i<d.length;i+=4){
        const lum = toLuminance(d[i], d[i+1], d[i+2]) / 255;
        let mapped;
        if(lum < 0.33) mapped = col1;
        else if(lum < 0.66) mapped = col2;
        else mapped = col3;
        d[i] = mapped.r;
        d[i+1] = mapped.g;
        d[i+2] = mapped.b;
      }

      // apply grunge noise
      for(let i=0;i<d.length;i+=4){
        const n = (Math.random()-0.5)*100; // stronger noise
        d[i] = Math.min(255, Math.max(0, d[i] + n));
        d[i+1] = Math.min(255, Math.max(0, d[i+1] + n));
        d[i+2] = Math.min(255, Math.max(0, d[i+2] + n));
      }

      ctx.putImageData(imgData,0,0);
      downloadBtn.disabled = false;
    }

    function loadFile(file){
      const img = new Image();
      img.onload = ()=>processExtreme(img);
      img.src = URL.createObjectURL(file);
    }

    drop.addEventListener('click',()=>fileInput.click());
    drop.addEventListener('dragover',e=>{e.preventDefault(); drop.classList.add('dragover');});
    drop.addEventListener('dragleave',()=>drop.classList.remove('dragover'));
    drop.addEventListener('drop',e=>{e.preventDefault(); drop.classList.remove('dragover'); if(e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]);});
    fileInput.addEventListener('change',()=>{if(fileInput.files.length) loadFile(fileInput.files[0]);});

    downloadBtn.addEventListener('click',()=>{
      const a=document.createElement('a');
      a.download='MARA-BANGSAT-1312-ACAB.png';
      a.href=canvas.toDataURL('image/png');
      a.click();
    });
  </script>
</body>
</html>
